<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-CN">
<head th:insert="include/head::head" th:with="title='订购记录'"></head>
<head th:include="include/head::bootstrap-table"></head>

<body class="layout-top-nav user-center" id="page-6">
<div class="wrapper">
    <!-- navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
            <li class="nav-item d-none d-sm-inline-block">
                <a th:href="@{/page/portal/index}" class="nav-link">产品介绍</a>
            </li>
            <li class="nav-item d-none d-sm-inline-block">
                <a th:href="@{/page/portal/package}" class="nav-link">产品套餐</a>
            </li>
        </ul>

        <!-- Right navbar links -->
        <ul class="nav nav-pills ml-auto">
            <li class="nav-item">
                <a class="nav-link btn btn-green-outline" th:href="@{/page/user/index}">登录</a>
            </li>
            <li style="width: 1rem"></li>
            <li class="nav-item">
                <a class="nav-link btn btn-green" th:href="@{/}">体验Demo</a>
            </li>
        </ul>
    </nav>


    <div class="content-wrapper">
        <!-- Main content -->
        <div class="content">
            <div class="container">
                <div class="card card-primary">
                    <div class="card-body" id="container">
                        <div class="row">
                            <div class="col-md-2" id="col-1">
                                <div class="card card-primary">
                                    <div class="card-body">
                                        <div class="user-left-top">
                                            <img th:src="@{/images/u3246.png}">
                                            <div class="text-theme">个人中心</div>
                                        </div>
                                        <ul>
                                            <li><a th:href="@{/page/user/index}">账号设置</a></li>
                                            <li><a th:href="@{/page/user/info}">会员信息</a></li>
                                            <li class="active"><a th:href="@{/page/user/orderInfo}">订购记录</a></li>
                                        </ul>
                                    </div>
                                </div>

                            </div>

                            <div class="col-md-10" id="col-2">
                                <div class="card card-primary">
                                    <div class="card-body">
                                        <h4>订购记录</h4>
                                        <div class="table-theme">
                                            <table id="tableGrid"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- /.content -->
    </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="payModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title text-theme">套餐购买</h4>
                <a class="btn close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </a>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <td>购买套餐：</td>
                        <td>白银会员</td>
                        <td>当前套餐到期时间：</td>
                        <td>2019年7月20日</td>
                    </tr>
                    <tr>
                        <td>购买时长：</td>
                        <td>372天</td>
                        <td>预计套餐到期时间：</td>
                        <td>2020年7月31日</td>
                    </tr>
                    <tr>
                        <td>所需费用：</td>
                        <td colspan="3">￥49</td>
                    </tr>
                    <tr>
                        <td>扣减费用：</td>
                        <td>￥49</td>
                        <td colspan="2">扣减说明：原套餐升级</td>
                    </tr>
                    <tr>
                        <td>支付金额：</td>
                        <td colspan="3">￥0  (支付前请阅读开通须知）</td>
                    </tr>
                    <tr>
                        <td>支付方式：</td>
                        <td colspan="3" class="pay-icon">
                            <button class="btn alipay-icon"></button>
                            <button class="btn wechat-cion"></button>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <div class="float-right">
                    <button class="btn btn-green-outline" data-dismiss="modal">取消</button>
                    <button class="btn btn-green">立即支付</button>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- REQUIRED SCRIPTS -->
<script>
    $('#tableGrid').bootstrapTable({
        url: ctx + "orderInfo.json", // 获取表格数据的url
        method: 'get',
        contentType: 'application/x-www-form-urlencoded',// 默认是post情况下是application/json
        classes: 'table table-no-bordered',// 设置table的class 默认是table table-hover
        cache: false, // 设置为 false 禁用 AJAX 数据缓存， 默认为true
        striped: true,  //表格显示条纹，默认为false
        pagination: true, // 在表格底部显示分页组件，默认false
        pageList: [10, 20, 30, 40, 50], // 设置页面可以显示的数据条数
        pageSize: 10, // 页面数据条数
        pageNumber: 1, // 首页页码
        sidePagination: 'server', // 设置为服务器端分页
        toolbar: '#toolbar',
        // showColumns:true,
        // showRefresh:true,
        // showToggle:true,
        iconSize: 'default',
        queryParams: function (params) {
            var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                limit: params.limit,   //页面大小
                offset: params.offset,  //页码
            };
            return temp;
        },
        singleSelect: true,
        columns: [
            {
                field: 'id',
                width: 30,
                title: '#',
                formatter: function (v, r, i) {
                    return parseInt(i) + 1;
                }
            },
            {
                field: 'orderTime',
                title: '订单时间',
            },
            {
                field: 'id',
                title: '订单ID',
            },
            {
                field: 'orderType',
                title: '订单类型',
            },
            {
                field: 'packageType',
                title: '套餐类型',
            },
            {
                field: 'period',
                title: '购买时长',
            },
            {
                field: 'cost',
                title: '套餐费用',
            },
            {
                field: 'discount',
                title: '扣减费用',
            },
            {
                field: 'payFee',
                title: '实际支付费用',
                formatter: function (v, r, i) {
                    return `<span class="text-theme">${v}</span>`;
                }
            },
            {
                field: 'status',
                title: '订单状态',
                align: 'center',
                formatter: function (v, r, i) {
                    let html;
                    if (v == '0') {
                        html = `<button class="btn btn-sm btn-green" onclick="showPayModal()">立即支付</button>`;
                    } else if (v == '1') {
                        html = `<span class="text-theme">支付成功</span>`;
                    } else if (v == '2') {
                        html = `<span class="text-danger">支付取消</span>`;
                    }
                    return html;
                }
            },
        ]
    })

    function showPayModal() {
        $('#payModal').modalShow('zoomIn',{vertical:true});
    }
</script>
</body>
</html>

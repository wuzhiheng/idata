<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-CN">
<head th:insert="include/head::head" th:with="title='订购记录'"></head>
<head th:include="include/head::bootstrap-table"></head>

<body class="layout-top-nav user-center" id="page-6">
<div class="wrapper">
    <!-- navbar -->
    <div th:insert="include/navbar::user-navbar"></div>

    <div class="content-wrapper">
        <!-- Main content -->
        <div class="content">
            <div class="container">
                <div class="card card-primary">
                    <div class="card-body" id="container">
                        <div class="row">

                            <div class="col-md-2" id="col-1" th:insert="include/sidebar::user-sidebar"
                                 th:with="active='订购记录'"></div>

                            <div class="col-md-10" id="col-2">
                                <div class="card card-primary">
                                    <div class="card-body">
                                        <h4>订购记录</h4>
                                        <div class="table-theme">
                                            <table id="tableGrid"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- /.content -->
    </div>

    <div th:replace="include/footer::footer"></div>
</div>

<div th:replace="include/modal::payModal"></div>

<!-- REQUIRED SCRIPTS -->
<script>
    $('#tableGrid').bootstrapTable({
        url: ctx + "orderInfo.json", // 获取表格数据的url
        method: 'get',
        contentType: 'application/x-www-form-urlencoded',// 默认是post情况下是application/json
        classes: 'table table-no-bordered',// 设置table的class 默认是table table-hover
        cache: false, // 设置为 false 禁用 AJAX 数据缓存， 默认为true
        striped: true,  //表格显示条纹，默认为false
        pagination: true, // 在表格底部显示分页组件，默认false
        pageList: [10, 20, 30, 40, 50], // 设置页面可以显示的数据条数
        pageSize: 10, // 页面数据条数
        pageNumber: 1, // 首页页码
        sidePagination: 'server', // 设置为服务器端分页
        toolbar: '#toolbar',
        // showColumns:true,
        // showRefresh:true,
        // showToggle:true,
        iconSize: 'default',
        queryParams: function (params) {
            var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                limit: params.limit,   //页面大小
                offset: params.offset,  //页码
            };
            return temp;
        },
        singleSelect: true,
        columns: [
            {
                field: 'id',
                width: 30,
                title: '#',
                formatter: function (v, r, i) {
                    return parseInt(i) + 1;
                }
            },
            {
                field: 'orderTime',
                title: '订单时间',
            },
            {
                field: 'id',
                title: '订单ID',
            },
            {
                field: 'orderType',
                title: '订单类型',
            },
            {
                field: 'packageType',
                title: '套餐类型',
            },
            {
                field: 'period',
                title: '购买时长',
            },
            {
                field: 'cost',
                title: '套餐费用',
            },
            {
                field: 'discount',
                title: '扣减费用',
            },
            {
                field: 'payFee',
                title: '实际支付费用',
                formatter: function (v, r, i) {
                    return '<span class="text-theme">'+v+'</span>';
                }
            },
            {
                field: 'status',
                title: '订单状态',
                align: 'center',
                formatter: function (v, r, i) {
                    let html;
                    if (v == '0') {
                        html = '<button class="btn btn-sm btn-green" onclick="showPayModal()">立即支付</button>';
                    } else if (v == '1') {
                        html = '<span class="text-theme">支付成功</span>';
                    } else if (v == '2') {
                        html = '<span class="text-danger">支付取消</span>';
                    }
                    return html;
                }
            },
        ]
    })

    function showPayModal() {
        $('#payModal').modalShow('zoomIn',{vertical:true});
    }
</script>
</body>
</html>
